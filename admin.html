<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>HOTEP Admin - Fixed UI</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
:root { --gold: #D4AF37; --black: #050505; --dark: #121212; --green: #2ecc71; --red: #e74c3c; --orange: #f39c12; --purple: #8e44ad; }
body { background: var(--black); color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; }

/* العداد العلوي */
.stats-bar { background: #000; padding: 15px 5px; display: flex; justify-content: space-around; border-bottom: 1px solid #222; }
.stat-item { text-align: center; }
.stat-item span { display: block; color: var(--gold); font-size: 12px; }
.stat-item b { font-size: 20px; color: #fff; }

/* التبويبات */
.tabs-container { display: flex; background: #111; padding: 5px; margin: 15px; border-radius: 15px; border: 1px solid #333; }
.tab-btn { flex: 1; padding: 12px; border: none; background: transparent; color: #888; cursor: pointer; border-radius: 10px; font-size: 14px; }
.tab-btn.active { background: var(--gold); color: #000; font-weight: bold; }

.tab-content { padding: 0 15px 100px; display: none; }
.tab-content.active { display: block; }

/* الكارت المعدل */
.order-card { background: var(--dark); border-radius: 20px; padding: 20px; margin-bottom: 15px; border: 1px solid #222; position: relative; border-right: 4px solid var(--gold); }

/* الاسم يمين والسعر يسار */
.card-top-row { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; }
.name-text { background: #1a1a1a; color: #fff; padding: 8px 15px; border-radius: 12px; font-size: 20px; font-weight: bold; border: 1px solid #333; order: 2; } /* order 2 يضعه يميناً */
.order-price { color: var(--green); font-size: 26px; font-weight: bold; order: 1; } /* order 1 يضعه يساراً */

.order-info { color: #aaa; font-size: 14px; line-height: 1.8; text-align: right; clear: both; }
.qty-badge { background: rgba(212, 175, 55, 0.1); color: var(--gold); padding: 5px 12px; border-radius: 8px; font-size: 13px; display: inline-block; margin: 10px 0; border: 1px solid rgba(212, 175, 55, 0.2); }

/* الأزرار */
.action-grid { display: flex; gap: 8px; margin-top: 15px; }
.btn-act { flex: 1; height: 45px; border-radius: 10px; border: none; color: #fff; font-size: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
.btn-ship-large { flex: 3; background: var(--purple); font-size: 16px; font-weight: bold; }
.btn-del { background: var(--red); max-width: 50px; }
.btn-copy { background: var(--orange); }
.btn-wa { background: #25d366; }
.btn-print { background: #fff; color: #000; }
.btn-done { background: var(--green); flex: 3; font-size: 16px; font-weight: bold; }
</style>
</head>
<body>

<div id="admin-content" style="display:block;">
    <div class="stats-bar">
        <div class="stat-item"><span>M</span><b id="sM">0</b></div>
        <div class="stat-item"><span>L</span><b id="sL">0</b></div>
        <div class="stat-item"><span>XL</span><b id="sXL">0</b></div>
        <div class="stat-item"><span>XXL</span><b id="sXXL">0</b></div>
    </div>
    <div style="text-align: center; color: #666; font-size: 12px; padding: 5px; cursor: pointer;" onclick="resetCounter()">تصفير السجل ↺</div>

    <div class="tabs-container">
        <button class="tab-btn active" onclick="openTab(event, 'new')">جديد</button>
        <button class="tab-btn" onclick="openTab(event, 'shipped')">مشحون</button>
        <button class="tab-btn" onclick="openTab(event, 'done')">مستلم</button>
    </div>

    <div id="new" class="tab-content active"><div id="newList"></div></div>
    <div id="shipped" class="tab-content"><div id="shippedList"></div></div>
    <div id="done" class="tab-content"><div id="doneList"></div></div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
let db;
const config = { databaseURL: "https://hotep-f423e-default-rtdb.europe-west1.firebasedatabase.app/" };
if (!firebase.apps.length) firebase.initializeApp(config);
db = firebase.database();

db.ref('orders').on('value', snap => {
    let html = { new:'', shipped:'', done:'' };
    snap.forEach(child => {
        const o = child.val();
        const id = child.key;
        const price = (parseInt(o.سعر_المنتج) || 0) + 50;
        const qty = o.الكمية || 1;
        const size = o.المقاس || 'M';

        const card = `
        <div class="order-card">
            <div class="card-top-row">
                <div class="name-text">${o.الاسم}</div>
                <div class="order-price">${price} ج</div>
            </div>
            <div class="order-info">
                <div class="qty-badge">${qty} علبة - مقاس ${size}</div><br>
                <i class="fas fa-phone"></i> ${o.الهاتف}<br>
                <i class="fas fa-map-marker-alt"></i> ${o.المحافظة} - ${o.العنوان}
            </div>
            <div class="action-grid">
                ${o.الحالة === 'مشحون' ? 
                `<button onclick="setStat('${id}','تم التسليم')" class="btn-act btn-done">تم التسليم</button>` : 
                (o.الحالة === 'تم التسليم' ? `<span style="flex:3; color:var(--green); text-align:center; line-height:45px;">✅ مستلم</span>` : `<button onclick="shipAndCount('${id}','${size}',${qty})" class="btn-act btn-ship-large">شحن الأوردر</button>`)
                }
                <button onclick="doPrint()" class="btn-act btn-print"><i class="fas fa-print"></i></button>
                <button onclick="wa('${o.الهاتف}','${o.الاسم}','${price}')" class="btn-act btn-wa"><i class="fab fa-whatsapp"></i></button>
                <button onclick="copyData('${o.الاسم}','${price}')" class="btn-act btn-copy"><i class="fas fa-copy"></i></button>
                <button onclick="del('${id}')" class="btn-act btn-del"><i class="fas fa-times"></i></button>
            </div>
        </div>`;

        if(o.الحالة === 'تم التسليم') html.done += card;
        else if(o.الحالة === 'مشحون') html.shipped += card;
        else html.new += card;
    });
    document.getElementById('newList').innerHTML = html.new;
    document.getElementById('shippedList').innerHTML = html.shipped;
    document.getElementById('doneList').innerHTML = html.done;
});

function openTab(evt, name) {
    let contents = document.getElementsByClassName("tab-content");
    for (let i = 0; i < contents.length; i++) contents[i].style.display = "none";
    let buttons = document.getElementsByClassName("tab-btn");
    for (let i = 0; i < buttons.length; i++) buttons[i].classList.remove("active");
    document.getElementById(name).style.display = "block";
    evt.currentTarget.classList.add("active");
}

window.shipAndCount = (id, size, qty) => {
    db.ref('stats_counter/' + size).transaction(c => (c || 0) + parseInt(qty));
    db.ref('orders/' + id).update({ الحالة: 'مشحون' });
};
window.setStat = (id, s) => db.ref('orders/'+id).update({ الحالة: s });
window.del = (id) => { if(confirm('حذف؟')) db.ref('orders/'+id).remove(); };
window.wa = (h, n, p) => window.open(`https://wa.me/2${h}?text=أهلاً أ/ ${n} تم شحن طلبك، الحساب ${p}ج`);
window.copyData = (n, p) => { navigator.clipboard.writeText(`${n}\n${p}ج`).then(() => alert("تم النسخ")); };
</script>
</body>
</html>
 
