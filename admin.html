
<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HOTEP Admin | Compact</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --gold: #D4AF37; --black: #050505; --dark: #121212; --green: #25d366; --orange: #ff8c00; }
        body { background: var(--black); color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; overflow-x: hidden; }
        
        /* تقليص الهيدر */
        .top-nav { background: var(--dark); padding: 8px 15px; border-bottom: 1px solid var(--gold); display: flex; justify-content: space-between; align-items: center; sticky: top; }
        .top-nav h1 { color: var(--gold); margin: 0; font-size: 16px; letter-spacing: 1px; }

        /* تصغير الكروت */
        .stats-container { display: flex; gap: 8px; padding: 10px; overflow-x: auto; }
        .stat-card { background: var(--dark); border: 1px solid #333; padding: 8px 15px; border-radius: 8px; flex: 1; text-align: center; min-width: 80px; }
        .stat-card i { font-size: 14px; color: var(--gold); margin-bottom: 3px; }
        .stat-card span { display: block; font-size: 14px; font-weight: bold; }
        .stat-label { font-size: 10px; color: #888; }

        /* جدول مضغوط جداً */
        .table-container { margin: 0 10px 10px; background: var(--dark); border-radius: 10px; border: 1px solid #333; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 850px; }
        th { background: #1a1a1a; color: var(--gold); padding: 8px; font-size: 11px; border-bottom: 1px solid #333; }
        td { padding: 6px 8px; border-bottom: 1px solid #222; text-align: center; font-size: 11px; }
        
        .client-info { text-align: right; line-height: 1.2; }
        .highlight { color: var(--gold); font-weight: bold; }
        
        /* تصغير الأزرار */
        .action-group { display: flex; gap: 4px; justify-content: center; }
        .btn-mini { width: 28px; height: 28px; border-radius: 6px; display: flex; align-items: center; justify-content: center; color: #fff; cursor: pointer; border: none; text-decoration: none; font-size: 12px; transition: 0.2s; }
        .btn-shipped { background: var(--green); }
        .btn-wa { background: #075e54; }
        .btn-share { background: var(--orange); }
        .btn-print { background: #444; }
        .btn-del { background: #bc1c1c; }
        .btn-mini:hover { transform: scale(1.1); }

        .status-tag { padding: 2px 6px; border-radius: 4px; font-size: 9px; font-weight: bold; text-transform: uppercase; }
        .status-new { color: #ffc107; border: 1px solid #ffc107; }
        .status-shipped { color: var(--green); border: 1px solid var(--green); }
    </style>
</head>
<body>

    <nav class="top-nav">
        <h1>HOTEP <span style="font-weight:100">| ADMIN</span></h1>
        <div id="time" style="font-size: 10px; color: #666;"></div>
    </nav>

    <div class="stats-container">
        <div class="stat-card"><div class="stat-label">الكل</div><span id="sAll">0</span></div>
        <div class="stat-card"><div class="stat-label">جديد</div><span id="sNew" style="color:#ffc107">0</span></div>
        <div class="stat-card"><div class="stat-label">مشحون</div><span id="sShipped" style="color:#25d366">0</span></div>
        <div class="stat-card"><div class="stat-label">الخزنة</div><span id="sMoney">0</span></div>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>تاريخ</th>
                    <th>العميل</th>
                    <th>العنوان</th>
                    <th>طلب</th>
                    <th>إجمالي</th>
                    <th>حالة</th>
                    <th>تحكم</th>
                </tr>
            </thead>
            <tbody id="ordersBody"></tbody>
        </table>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        const firebaseConfig = { databaseURL: "https://hotep-f423e-default-rtdb.europe-west1.firebasedatabase.app/" };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database().ref('orders');

        db.on('value', (snapshot) => {
            const tbody = document.getElementById('ordersBody');
            tbody.innerHTML = '';
            let s = { all: 0, new: 0, shipped: 0, money: 0 };

            snapshot.forEach((child) => {
                const o = child.val();
                const id = child.key;
                s.all++;
                (o.الحاله === 'تم الشحن') ? s.shipped++ : s.new++;
                s.money += (parseInt(o.الاجمالي) || 0);

                const waText = encodeURIComponent(`✅ تأكيد HOTEP\nأستاذ ${o.الاسم}، طلبك ${o.الكمية} مقاس ${o.المقاس} جاهز. الحساب: ${o.الاجمالي}ج.\nأكد الجاهزية؟`);
                const billText = `HOTEP BILL\n---\nالعميل: ${o.الاسم}\nهاتف: ${o.الهاتف}\n${o.المحافظة}: ${o.العنوان}\nالمحتوى: ${o.الكمية} - ${o.المقاس}\nالحساب: ${o.الاجمالي}ج`;

                const row = `
                    <tr>
                        <td style="color:#666; font-size:9px">${o.التاريخ ? o.التاريخ.split(',')[0] : '-'}</td>
                        <td class="client-info"><b>${o.الاسم}</b><br>${o.الهاتف}</td>
                        <td class="client-info">${o.المحافظة}<br><span style="color:#666">${o.العنوان}</span></td>
                        <td>${o.المقاس}<br><span class="highlight">${o.الكمية}</span></td>
                        <td class="highlight" style="color:#25d366">${o.الاجمالي}ج</td>
                        <td><span class="status-tag ${o.الحاله === 'تم الشحن' ? 'status-shipped' : 'status-new'}">${o.الحاله || 'جديد'}</span></td>
                        <td>
                            <div class="action-group">
                                <button onclick="mark('${id}')" class="btn-mini btn-shipped"><i class="fas fa-check"></i></button>
                                <a href="https://wa.me/2${o.الهاتف}?text=${waText}" target="_blank" class="btn-mini btn-wa"><i class="fab fa-whatsapp"></i></a>
                                <button onclick="copy('${billText.replace(/\n/g, '\\n')}')" class="btn-mini btn-share"><i class="fas fa-share-nodes"></i></button>
                                <button onclick="prnt('${id}')" class="btn-mini btn-print"><i class="fas fa-print"></i></button>
                                <button onclick="del('${id}')" class="btn-mini btn-del"><i class="fas fa-times"></i></button>
                            </div>
                        </td>
                    </tr>`;
                tbody.insertAdjacentHTML('afterbegin', row);
            });
            document.getElementById('sAll').innerText = s.all;
            document.getElementById('sNew').innerText = s.new;
            document.getElementById('sShipped').innerText = s.shipped;
            document.getElementById('sMoney').innerText = s.money + "ج";
        });

        function mark(id) { db.child(id).update({ الحاله: 'تم الشحن' }); }
        function copy(t) { navigator.clipboard.writeText(t.replace(/\\n/g, '\n')).then(() => alert("تم نسخ البوليصة")); }
        function del(id) { if(confirm('حذف؟')) db.child(id).remove(); }
        function prnt(id) {
            db.child(id).once('value', s => {
                const o = s.val();
                const w = window.open('', '', 'width=400,height=400');
                w.document.write(`<div dir="rtl" style="font-family:sans-serif; border:1px solid #000; padding:10px;">
                    <h3>بوليصة HOTEP</h3>
                    <p>${o.الاسم} | ${o.الهاتف}<br>${o.المحافظة} - ${o.العنوان}</p>
                    <p>الطلب: ${o.الكمية} (${o.المقاس})</p>
                    <hr><b>المطلوب: ${o.الاجمالي}ج</b>
                </div>`);
                w.print(); w.close();
            });
        }
        setInterval(() => { document.getElementById('time').innerText = new Date().toLocaleTimeString('ar-EG'); }, 1000);
    </script>
</body>
</html>
